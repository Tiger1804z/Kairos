# ğŸ“‹ PLAN.MD - Projet Kairos

**DerniÃ¨re mise Ã  jour :** 2026-02-05
**Progression globale :** 65%
**Type de projet :** Projet scolaire (MVP pour prÃ©sentation)
**Focus actuel :** ğŸ¨ **FRONTEND** (Backend ~90% complÃ©tÃ©)

---

## ğŸ¯ Vue d'ensemble du projet

**Kairos** est une plateforme MVP de gestion d'entreprise avec intelligence artificielle qui permet aux propriÃ©taires de PME de :
- GÃ©rer leurs clients, engagements et transactions
- Analyser leurs documents financiers automatiquement (OpenAI)
- Obtenir des insights via un assistant IA (**backend dÃ©jÃ  fait**, Ã  connecter au frontend)
- Visualiser leurs donnÃ©es via un dashboard interactif

**ğŸ“ Objectif scolaire :** PrÃ©senter un MVP fonctionnel avec les fonctionnalitÃ©s principales

---

## ğŸ—ï¸ Architecture Technique

### Backend (Node.js + TypeScript)
- **Framework :** Express.js
- **Base de donnÃ©es :** PostgreSQL via Prisma ORM
- **Authentification :** JWT avec middleware `requireAuth`
- **SÃ©curitÃ© :** Business scoping avec `requireBusinessAccess`
- **Structure :** Architecture 3-couches (Routes â†’ Controllers â†’ Services)

### Frontend (React + TypeScript)
- **Framework :** React 18 + React Router
- **Styling :** TailwindCSS
- **State Management :** Context API (AuthContext, BusinessContext)
- **API Client :** Axios avec intercepteurs JWT

### Service Python (FastAPI)
- **Extraction de documents :** PDF, CSV, TXT
- **Communication :** HTTP avec le backend Node.js
- **Stockage :** Fichiers locaux structurÃ©s

---

## âœ… FonctionnalitÃ©s ImplÃ©mentÃ©es (65%)

### ğŸ” Authentification & Autorisation
- [x] Inscription utilisateur (signup)
- [x] Connexion (login)
- [x] Middleware JWT (`requireAuth`)
- [x] Protection des routes frontend (`RequireAuth`)
- [x] Context d'authentification (`AuthContext`)
- [x] Redirection vers login si non authentifiÃ©

### ğŸ‘¤ Gestion des Utilisateurs
- [x] Endpoint GET `/auth/me` - RÃ©cupÃ©rer l'utilisateur connectÃ©
- [x] SystÃ¨me de rÃ´les (owner, admin, employee)
- [x] Page de profil basique

### ğŸ¢ Gestion des Businesses
- [x] CRUD businesses complet
- [x] Middleware `requireBusinessAccess` (vÃ©rification ownership)
- [x] Context global `BusinessContext`
- [x] SÃ©lecteur de business dans le header
- [x] Persistance du business sÃ©lectionnÃ© (localStorage)

### ğŸ‘¥ Gestion des Clients
- [x] CRUD clients complet
- [x] Filtrage par business
- [x] Page liste des clients
- [x] Validation email unique par business

### ğŸ“„ Gestion des Documents
- [x] Upload de documents (multer)
- [x] Stockage structurÃ© par business/date
- [x] Extraction de contenu via service Python
- [x] Analyse IA (finance ou gÃ©nÃ©ral)
- [x] Persistance mÃ©tadonnÃ©es (Prisma)

### ğŸ’° Gestion des Transactions
- [x] CRUD transactions
- [x] Types : income/expense
- [x] MÃ©thodes de paiement
- [x] CatÃ©gorisation
- [x] Liaison avec clients/engagements

### ğŸ“Š Gestion des Engagements
- [x] CRUD engagements
- [x] Statuts (draft, active, completed, cancelled)
- [x] Items d'engagement (products, services, hourly, subscription)
- [x] Calcul des totaux

### ğŸ“ˆ Dashboard (NOUVEAU - ComplÃ©tÃ© aujourd'hui)
- [x] **Backend :**
  - [x] Service `dashboardService.ts` avec 3 fonctions
  - [x] Controller `dashboardController.ts`
  - [x] Routes `dashboardRoutes.ts` protÃ©gÃ©es
  - [x] Endpoint GET `/dashboard/metrics` (clients, engagements, revenu)
  - [x] Endpoint GET `/dashboard/top-clients` (top 5 par revenu)
  - [x] Endpoint GET `/dashboard/revenue-growth` (croissance mois par mois)
- [x] **Frontend :**
  - [x] Hook `useDashboard()` pour fetch les donnÃ©es
  - [x] Page `DashboardPage.tsx` avec vraies donnÃ©es API
  - [x] Composant `BusinessSelector` dans le header
  - [x] Affichage mÃ©triques principales
  - [x] Affichage top clients
  - [x] Affichage croissance du revenu
  - [x] Loading states et error handling
  - [x] Formatage monÃ©taire (CAD)

### ğŸ¤– Intelligence Artificielle (Backend COMPLET âœ…)
- [x] **Service `aiService.ts` complet avec OpenAI**
- [x] **Endpoint POST `/ai/ask`** - Questions naturelles â†’ SQL â†’ RÃ©ponses
- [x] **Endpoint GET `/ai/daily-finance-summary`** - RÃ©sumÃ© quotidien
- [x] GÃ©nÃ©ration de SQL sÃ©curisÃ© (`generateSQLFromQuestion`)
- [x] Validation SQL avec `sqlGuard`
- [x] Analyse de documents financiers (PDF, CSV)
- [x] DÃ©tection automatique du type de document
- [x] GÃ©nÃ©ration de rÃ©sumÃ©s avec GPT-4o-mini
- [x] Logging automatique des requÃªtes (`QueryLog`)
- [x] CrÃ©ation automatique de rapports (`Report`)
- [x] Support multi-intents (revenus, dÃ©penses, net, par catÃ©gorie)
- [ ] **Frontend : Connecter `AskKairosInput` Ã  l'API** âš ï¸ Ã€ FAIRE

### ğŸ“Š Rapports & Logs
- [x] QueryLogs (historique des requÃªtes IA)
- [x] Rapports gÃ©nÃ©rÃ©s
- [x] Persistance en base de donnÃ©es

---

## ğŸš§ En Cours de DÃ©veloppement (0%)

_Rien en cours actuellement_

---

## ğŸ“ FonctionnalitÃ©s Ã  ImplÃ©menter - MVP SCOLAIRE (35%)

### ğŸ¯ PRIORITÃ‰ MVP - Ã€ FAIRE POUR LA PRÃ‰SENTATION

#### 1. ğŸ¤– Connecter l'Assistant IA (CRITIQUE)
- [ ] **Frontend uniquement - Backend dÃ©jÃ  fait âœ…**
  - [ ] Hook `useAskKairos()` pour appeler POST `/ai/ask`
  - [ ] Connecter `AskKairosInput` au backend
  - [ ] Afficher les rÃ©ponses de l'IA dans une Card
  - [ ] Loading state pendant la gÃ©nÃ©ration
  - [ ] Afficher le SQL gÃ©nÃ©rÃ© (optionnel)
  - [ ] Gestion d'erreurs (unsafe SQL, erreur serveur)

#### 2. ğŸ“Š Dashboard - Graphiques (IMPORTANT)
- [ ] Installer Recharts
- [ ] Graphique de croissance du revenu (line chart) - 2-3 mois
- [ ] Graphique rÃ©partition revenus/dÃ©penses (pie chart)
- [ ] Rendre responsive

#### 3. ğŸ’° Page Liste des Transactions (NICE TO HAVE)
- [ ] Page `/dashboard/transactions`
- [ ] Table avec filtres (date, type, catÃ©gorie)
- [ ] Pagination simple
- [ ] Lien depuis le dashboard

### ğŸ”® HORS SCOPE MVP - Pour release future
_Ces fonctionnalitÃ©s ne sont PAS nÃ©cessaires pour la prÃ©sentation scolaire_

<details>
<summary>FonctionnalitÃ©s post-MVP (cliquer pour voir)</summary>

#### Clients
- [ ] Page dÃ©tail client avec historique
- [ ] Notes et timeline des interactions

#### Documents
- [ ] Preview et tÃ©lÃ©chargement
- [ ] Recherche full-text

#### Transactions
- [ ] Import CSV
- [ ] RÃ©conciliation bancaire

#### Engagements
- [ ] GÃ©nÃ©ration de factures PDF
- [ ] Envoi par email

#### Rapports
- [ ] GÃ©nÃ©rateur personnalisÃ©
- [ ] Export multi-formats

#### ParamÃ¨tres
- [ ] Page paramÃ¨tres complÃ¨te
- [ ] Changement de mot de passe

#### Notifications
- [ ] SystÃ¨me temps rÃ©el
- [ ] Email notifications

#### Multi-utilisateurs
- [ ] Invitation d'Ã©quipe
- [ ] Gestion permissions avancÃ©e
</details>

---

## ğŸ—‚ï¸ Structure des Fichiers

### Backend (`Kairos-backend/`)
```
src/
â”œâ”€â”€ controllers/     # Logique HTTP (req/res)
â”‚   â”œâ”€â”€ authController.ts
â”‚   â”œâ”€â”€ dashboardController.ts âœ… NOUVEAU
â”‚   â”œâ”€â”€ clientController.ts
â”‚   â””â”€â”€ ...
â”œâ”€â”€ services/       # Logique mÃ©tier + DB
â”‚   â”œâ”€â”€ authService.ts
â”‚   â”œâ”€â”€ dashboardService.ts âœ… NOUVEAU
â”‚   â”œâ”€â”€ clientsService.ts
â”‚   â””â”€â”€ ...
â”œâ”€â”€ routes/         # DÃ©finition des endpoints
â”‚   â”œâ”€â”€ authRoutes.ts
â”‚   â”œâ”€â”€ dashboardRoutes.ts âœ… NOUVEAU
â”‚   â”œâ”€â”€ clientRoutes.ts
â”‚   â””â”€â”€ ...
â”œâ”€â”€ middleware/     # Middlewares Express
â”‚   â”œâ”€â”€ authMiddleware.ts
â”‚   â””â”€â”€ requireBusinessAccess.ts
â”œâ”€â”€ prisma/         # Client Prisma
â””â”€â”€ index.ts        # Point d'entrÃ©e
```

### Frontend (`kairos-frontend/`)
```
src/
â”œâ”€â”€ pages/          # Pages React
â”‚   â”œâ”€â”€ auth/       # Login/Signup
â”‚   â”œâ”€â”€ dashboard/  # Dashboard principal âœ… UPDATED
â”‚   â””â”€â”€ landing/    # Page d'accueil
â”œâ”€â”€ components/     # Composants rÃ©utilisables
â”‚   â”œâ”€â”€ dashboard/  # BusinessSelector âœ… NOUVEAU
â”‚   â”œâ”€â”€ layout/     # Layout (Sidebar, Header)
â”‚   â”œâ”€â”€ ui/         # Composants UI de base
â”‚   â””â”€â”€ kairos/     # AskKairosInput
â”œâ”€â”€ hooks/          # Custom hooks
â”‚   â””â”€â”€ useDashboard.ts âœ… NOUVEAU
â”œâ”€â”€ business/       # BusinessContext âœ… NOUVEAU
â”‚   â””â”€â”€ BusinessContext.tsx
â”œâ”€â”€ auth/           # AuthContext
â”‚   â””â”€â”€ AuthContext.tsx
â”œâ”€â”€ lib/            # Utils
â”‚   â”œâ”€â”€ api.ts      # Client Axios
â”‚   â””â”€â”€ constants.ts
â””â”€â”€ app/            # Config app
    â”œâ”€â”€ App.tsx
    â”œâ”€â”€ router.tsx
    â””â”€â”€ providers.tsx âœ… UPDATED
```

---

## ğŸ¯ Prochaines Actions Prioritaires (MVP)

### Session Suivante - ORDRE DE PRIORITÃ‰
1. **ğŸ¤– Connecter Assistant IA Kairos** (CRITIQUE - DÃ©mo WOW)
   - Backend dÃ©jÃ  fait âœ…
   - CrÃ©er hook `useAskKairos()`
   - Connecter `AskKairosInput` Ã  POST `/ai/ask`
   - Afficher rÃ©ponse de l'IA
   - Temps estimÃ© : 1-2h

2. **ğŸ“Š Ajouter graphiques au dashboard** (IMPORTANT - Visuel)
   - Installer Recharts
   - Line chart croissance revenu
   - Pie chart revenus vs dÃ©penses
   - Temps estimÃ© : 2-3h

3. **ğŸ“ Ajouter donnÃ©es de test** (OPTIONNEL)
   - Transactions fÃ©vrier 2026
   - Pour avoir des graphiques avec data

4. **ğŸ’° Page liste transactions** (NICE TO HAVE)
   - Si temps restant
   - Pour complÃ©ter le MVP

---

## ğŸ“Š MÃ©triques de Progression MVP

| CatÃ©gorie | Backend | Frontend | Statut MVP |
|-----------|---------|----------|------------|
| **Authentification** | 100% âœ… | 100% âœ… | âœ… COMPLET |
| **Gestion Business** | 100% âœ… | 100% âœ… | âœ… COMPLET |
| **Gestion Clients** | 100% âœ… | 70% âš ï¸ | âš ï¸ OK pour MVP (CRUD fait) |
| **Documents** | 100% âœ… | 80% âš ï¸ | âœ… SUFFISANT (Upload/Analyse OK) |
| **Transactions** | 100% âœ… | 40% âŒ | âš ï¸ Backend OK, UI liste manquante |
| **Engagements** | 100% âœ… | 40% âŒ | âš ï¸ Backend OK, UI liste manquante |
| **Dashboard** | 100% âœ… | 60% âš ï¸ | âš ï¸ MÃ©triques OK, graphiques Ã  ajouter |
| **IA Assistant** | 100% âœ… | 10% âŒ | âŒ **CRITIQUE** : Ã€ connecter au frontend |
| **Rapports** | 100% âœ… | 0% âŒ | âœ… OK (logs backend suffisants) |

### LÃ©gende
- âœ… **COMPLET** : PrÃªt pour MVP
- âš ï¸ **PARTIEL** : Utilisable mais amÃ©liorable
- âŒ **MANQUANT** : Ã€ faire pour MVP complet

---

## ğŸ”§ Configuration Requise

### Variables d'environnement Backend (.env)
```env
DATABASE_URL=postgresql://...
JWT_SECRET=...
PORT=3000
KAIROS_EXTRACTOR_KEY=kairos_dev_secret
KAIROS_EXTRACTOR_URL=http://localhost:8001
```

### Variables d'environnement Frontend (.env)
```env
VITE_API_BASE_URL=http://localhost:3000
```

### Commandes de dÃ©marrage
```bash
# Backend
cd Kairos-backend
npm run dev

# Frontend
cd kairos-frontend
npm run dev

# Service Python (optionnel)
cd Kairos-backend/python-extractor
uvicorn app.main:app --reload --port 8001
```

---

## ğŸ“ Notes Importantes

### Conventions de Code
- **TypeScript strict mode** activÃ©
- **Nomenclature :**
  - Fichiers : camelCase pour les fichiers TS/JS, PascalCase pour les composants React
  - Variables : camelCase
  - Types : PascalCase
  - Constantes : UPPER_SNAKE_CASE
- **Architecture :** Toujours suivre le pattern Routes â†’ Controllers â†’ Services
- **SÃ©curitÃ© :** Toujours utiliser `requireAuth` + `requireBusinessAccess` pour les endpoints sensibles

### Bugs Connus
- Aucun bug critique actuellement

### AmÃ©liorations Techniques Future
- [ ] Migration vers React Query pour le state management serveur
- [ ] Ajout de tests unitaires (Jest + React Testing Library)
- [ ] Ajout de tests E2E (Playwright)
- [ ] Dockerisation complÃ¨te
- [ ] CI/CD avec GitHub Actions
- [ ] Monitoring et logging (Sentry)

---

## ğŸ“š Ressources

- [Documentation Prisma](https://www.prisma.io/docs)
- [Documentation React Router](https://reactrouter.com/)
- [Documentation TailwindCSS](https://tailwindcss.com/docs)
- [API Claude (Anthropic)](https://docs.anthropic.com/)

---

## ğŸ¯ Objectif MVP Final

**Pour la prÃ©sentation scolaire, on doit avoir :**
1. âœ… Dashboard fonctionnel avec vraies donnÃ©es
2. âš ï¸ Graphiques de visualisation (en cours)
3. âŒ **Assistant IA Kairos fonctionnel** (CRITIQUE - Ã  faire en prioritÃ©)
4. âœ… Upload et analyse de documents
5. âœ… Gestion des clients et business

**DÃ©lai estimÃ© pour MVP complet : 3-5h de travail frontend**

---

**ğŸ¯ Session actuelle : Dashboard backend + frontend implÃ©mentÃ© avec succÃ¨s âœ…**
**ğŸ¯ Prochaine session : Connecter Assistant IA au frontend (PRIORITÃ‰ #1)**

_DerniÃ¨re mise Ã  jour PLAN.MD : 2026-02-05 - RÃ©ajustÃ© pour scope MVP scolaire_
